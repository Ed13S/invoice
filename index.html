---
layout: default
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title id="pageTitle">Invoice</title>
    <style>
        /* Force the background to be neutral so theme colors don't bleed in */
        #main-content { background: #f4f4f4 !important; padding: 20px 10px; min-height: 100vh; }
        
        .invoice-container { 
            max-width: 700px; 
            background: white !important; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin: auto;
            color: #333 !important; /* Forces text to be dark even on dark themes */
        }

        h2, label { color: #333 !important; font-family: sans-serif; }

        textarea { 
            width: 100%; height: 100px; margin-bottom: 15px; 
            border: 1px solid #ccc; border-radius: 6px; padding: 12px; 
            box-sizing: border-box; font-size: 16px; 
        }

        .manual-row { display: flex; gap: 10px; margin-bottom: 15px; }
        .manual-row input { 
            flex: 2; padding: 12px; border: 1px solid #ccc; 
            border-radius: 6px; font-size: 16px; 
        }

        .btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        button { 
            padding: 14px; border: none; border-radius: 6px; 
            cursor: pointer; font-weight: bold; font-size: 14px; color: white; 
        }
        .btn-blue { background: #007bff; }
        .btn-green { background: #28a745; }
        .btn-red { background: #dc3545; }
        
        /* Invoice Table Styling */
        .invoice-box { 
            border: 1px solid #eee; padding: 25px; 
            line-height: 1.6; background: white; margin-top: 20px;
        }
        table { width: 100%; text-align: left; border-collapse: collapse; }
        table td { padding: 10px; vertical-align: top; color: #333 !important; }
        table tr.heading td { background: #f8f9fa; font-weight: bold; border-bottom: 2px solid #ddd; }
        table tr.item td { border-bottom: 1px solid #eee; }
        table tr.total td { border-top: 2px solid #333; font-weight: bold; font-size: 20px; }
        
        .del-x { color: #dc3545; cursor: pointer; border: none; background: none; font-size: 18px; padding: 0 5px; }

        @media print { 
            .no-print { display: none !important; } 
            body, #main-content { background: white !important; margin: 0; padding: 0; }
            .invoice-container { box-shadow: none; border: none; width: 100%; max-width: 100%; padding: 0; }
        }
    </style>
</head>
<body>

<div id="main-content">
    <div class="invoice-container">
        <div class="no-print">
            <h2 style="margin-top:0">Invoice Creator</h2>
            
            <label>Paste Trip Logs:</label>
            <textarea id="inputData" placeholder="Example: Week 1, 8/12-12/12, $48..."></textarea>
            
            <label>Or Enter Manually:</label>
            <div class="manual-row">
                <input type="text" id="mDesc" placeholder="Description">
                <input type="number" id="mPrice" placeholder="Price">
            </div>

            <div class="btn-group">
                <button class="btn-blue" onclick="processText()">Process Text</button>
                <button class="btn-green" onclick="addManual()">+ Add Manual</button>
            </div>
            <button class="btn-red" style="width:100%; margin-bottom: 20px;" onclick="clearAll()">Clear All Lines</button>
        </div>

        <div id="output" class="invoice-box" style="display:none;">
            <table>
                <tr>
                    <td>
                        <strong style="font-size: 1.2em;">Taxi Trips Invoice:</strong><br>
                        G Dureja<br>
                        ABN: 15 685 270 239<br>
                        Contact: 0404 843 222
                    </td>
                </tr>
                <tr style="height:20px;"></tr>
                <tr>
                    <td><strong>Billing Details:</strong><br>Ref: <span id="refId"></span><br>Date: <span id="curDate"></span></td>
                    <td style="text-align:right"><strong>Due Date:</strong><br><span id="dueDate"></span></td>
                </tr>
            </table>
            <br>
            <table>
                <thead>
                    <tr class="heading">
                        <td>Description</td>
                        <td style="text-align:right">Price</td>
                        <td class="no-print" style="width:40px"></td>
                    </tr>
                </thead>
                <tbody id="lineItems"></tbody>
                <tfoot>
                    <tr class="total">
                        <td>Grand Total:</td>
                        <td style="text-align:right" id="grandTotal">$0.00</td>
                        <td class="no-print"></td>
                    </tr>
                </tfoot>
            </table>
            <button class="btn-blue no-print" style="width:100%; margin-top:20px; font-size: 16px;" onclick="window.print()">Print / Save PDF</button>
        </div>
    </div>
</div>

<script>
    let lines = [];

    function processText() {
        const text = document.getElementById('inputData').value;
        const regex = /(Week\s\d+)[^\d]*(\d+\/\d+-\d+\/\d+)[^\$]*\$(\d+)/gi;
        let matches = [...text.matchAll(regex)];
        
        matches.forEach(m => {
            lines.push({ d: `${m[1]} (${m[2]})`, p: parseFloat(m[3]) });
        });

        if(matches.length === 0) {
            const totalMatch = text.match(/Total\s*\$?(\d+)/i);
            if(totalMatch) lines.push({ d: "Total from text", p: parseFloat(totalMatch[1]) });
        }
        
        updateInvoice();
        document.getElementById('inputData').value = '';
    }

    function addManual() {
        const d = document.getElementById('mDesc').value;
        const p = document.getElementById('mPrice').value;
        if(d && p) {
            lines.push({ d: d.toUpperCase(), p: parseFloat(p) });
            updateInvoice();
            document.getElementById('mDesc').value = '';
            document.getElementById('mPrice').value = '';
        }
    }

    function deleteLine(index) {
        lines.splice(index, 1);
        updateInvoice();
    }

    function clearAll() {
        if(confirm("Clear everything?")) {
            lines = [];
            updateInvoice();
        }
    }

    function updateInvoice() {
        const now = new Date();
        const due = new Date();
        due.setMonth(now.getMonth() + 1);

        const day = String(now.getDate()).padStart(2, '0');
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const year = now.getFullYear();
        const dateString = `${day}${month}${year}`;

        // THIS SETS THE PDF FILENAME
        document.title = dateString;

        document.getElementById('refId').innerText = dateString;
        document.getElementById('curDate').innerText = now.toLocaleDateString('en-GB');
        document.getElementById('dueDate').innerText = due.toLocaleDateString('en-GB');

        const tbody = document.getElementById('lineItems');
        tbody.innerHTML = '';
        let total = 0;

        lines.forEach((item, index) => {
            total += item.p;
            tbody.innerHTML += `
                <tr class="item">
                    <td>${item.d}</td>
                    <td style="text-align:right">$${item.p.toFixed(2)}</td>
                    <td class="no-print" style="text-align:right"><button class="del-x" onclick="deleteLine(${index})">âœ•</button></td>
                </tr>`;
        });

        document.getElementById('grandTotal').innerText = `$${total.toFixed(2)}`;
        document.getElementById('output').style.display = lines.length > 0 ? 'block' : 'none';
    }
</script>

</body>
</html>
