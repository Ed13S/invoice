<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Taxi Invoice Generator</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 40px; background: #f4f4f4; }
        .container { max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        textarea { width: 100%; height: 100px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; padding: 10px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; width: 100%; font-size: 16px; }
        #output { margin-top: 20px; border-top: 2px solid #eee; padding-top: 20px; display: none; }
        .invoice-box { border: 1px solid #eee; padding: 30px; line-height: 1.6; color: #555; }
        table { width: 100%; line-height: inherit; text-align: left; border-collapse: collapse; }
        table td { padding: 5px; vertical-align: top; }
        table tr.heading td { background: #eee; border-bottom: 1px solid #ddd; font-weight: bold; }
        table tr.item td { border-bottom: 1px solid #eee; }
        table tr.total td { border-top: 2px solid #eee; font-weight: bold; }
        @media print { .no-print { display: none; } .container { box-shadow: none; width: 100%; max-width: none; } }
    </style>
</head>
<body>

<div class="container">
    <div class="no-print">
        <h2>Invoice Creator</h2>
        <p>Paste the message here:</p>
        <textarea id="inputData" placeholder="Week 1, 8/12-12/12, $48..."></textarea>
        <button onclick="generateInvoice()">Generate & Preview</button>
        <p><small>Press Ctrl+P (or Cmd+P) to save as PDF after generating.</small></p>
    </div>

    <div id="output" class="invoice-box">
        <div id="invoiceContent"></div>
    </div>
</div>

<script>
function generateInvoice() {
    const text = document.getElementById('inputData').value;
    const now = new Date();
    
    // Formatting Dates
    const refNum = now.toLocaleDateString('en-GB').replace(/\//g, ''); // DDMMYYYY
    const todayStr = now.toLocaleDateString('en-GB');
    const dueDate = new Date();
    dueDate.setMonth(now.getMonth() + 1);
    const dueDateStr = dueDate.toLocaleDateString('en-GB');

    // Basic Logic to extract Weeks and Prices
    // Regex finds "Week X", "Date range", and "$Price"
    const lines = text.split('\n');
    let itemsHtml = '';
    let subtotal = 0;

    const regex = /(Week\s\d+)[^\d]*(\d+\/\d+-\d+\/\d+)[^\$]*\$(\d+)/gi;
    let match;
    
    // Fallback parser if text is messy
    const matches = [...text.matchAll(regex)];
    
    matches.forEach(m => {
        const price = parseFloat(m[3]);
        subtotal += price;
        itemsHtml += `<tr class="item">
            <td>${m[1]} (${m[2]})</td>
            <td>1</td>
            <td>$${price.toFixed(2)}</td>
            <td>$${price.toFixed(2)}</td>
        </tr>`;
    });

    // If regex fails, look for totals specifically
    if(subtotal === 0) {
        const totalMatch = text.match(/Total\s*\$?(\d+)/i);
        subtotal = totalMatch ? parseFloat(totalMatch[1]) : 0;
    }

    const html = `
        <table>
            <tr><td colspan="2"><strong>Business Identification:</strong><br>Taxi Trips Invoice<br>ABN: 15 685 270 239<br>Contact: 0404 843 222</td></tr>
            <tr style="height:20px;"></tr>
            <tr>
                <td><strong>Billing Details:</strong><br>Ref: ${refNum}<br>Date: ${todayStr}</td>
                <td style="text-align:right"><strong>Due Date:</strong><br>${dueDateStr}</td>
            </tr>
        </table>
        <br>
        <table>
            <tr class="heading"><td>Item Description</td><td>Qty</td><td>Unit Price</td><td>Total</td></tr>
            ${itemsHtml || '<tr><td colspan="4">See total below</td></tr>'}
            <tr class="total">
                <td colspan="2"></td>
                <td>Subtotal:</td>
                <td>$${subtotal.toFixed(2)}</td>
            </tr>
            <tr class="total">
                <td colspan="2"></td>
                <td>Grand Total:</td>
                <td>$${subtotal.toFixed(2)}</td>
            </tr>
        </table>
    `;

    document.getElementById('invoiceContent').innerHTML = html;
    document.getElementById('output').style.display = 'block';
}
</script>

</body>
</html>